# Деплой Telegram Quiz Bot на Railway

Пошаговая инструкция для первого деплоя и дальнейших обновлений.

---

## 1. Подготовка репозитория

1. Создайте репозиторий на GitHub (если ещё нет) и залейте проект:
   ```bash
   git init
   git add .
   git commit -m "Initial commit"
   git remote add origin https://github.com/YOUR_USERNAME/YOUR_REPO.git
   git push -u origin main
   ```
2. **Не коммитьте** токен бота и файл `quiz_bot.db` — они уже в `.gitignore`. Токен задаётся через переменные окружения на Railway.

---

## 2. Первый деплой на Railway

### 2.1 Создание проекта

1. Зайдите на [railway.app](https://railway.app) и войдите (через GitHub удобнее).
2. **New Project** → **Deploy from GitHub repo**.
3. Выберите репозиторий с ботом и ветку (обычно `main`).
4. Railway создаст сервис и начнёт первый деплой.

### 2.2 Переменные окружения (Variables)

1. Откройте созданный сервис.
2. Вкладка **Variables** → **Add Variable** (или **RAW Editor**).
3. Добавьте:
   - `BOT_TOKEN` = токен от [@BotFather](https://t.me/BotFather) (обязательно).
   - `DB_PATH` = `/data/quiz_bot.db` — если будете использовать Volume (см. ниже). Иначе можно не задавать (по умолчанию `quiz_bot.db` в рабочей папке).

### 2.3 Start Command (команда запуска)

1. Сервис → **Settings**.
2. В блоке **Deploy** найдите **Start Command** (или **Custom Start Command**).
3. Укажите: `python bot.py`  
   (если в проекте есть `Procfile` с `worker: python bot.py`, Railway может подхватить его сам; при необходимости задайте команду вручную).

### 2.4 Сохранение базы данных (Volume)

Без тома при каждом редеплое база `quiz_bot.db` будет создаваться заново. Чтобы данные сохранялись:

1. В сервисе: **Settings** → **Volumes** → **Add Volume**.
2. Укажите **Mount Path**: `/data`.
3. В **Variables** задайте: `DB_PATH=/data/quiz_bot.db`.
4. Перезапустите сервис (Redeploy).

После этого база будет храниться в томе и не пропадёт при обновлениях.

### 2.5 Проверка

1. Вкладка **Deployments** — последний деплой должен быть в статусе **Success** (зелёный).
2. Вкладка **Logs** — в логах не должно быть ошибки про `BOT_TOKEN`; бот должен запускаться без исключений.
3. Напишите боту в Telegram — он должен отвечать.

---

## 3. Обновления бота (как обновлять в будущем)

### Вариант A: Автодеплой с GitHub (рекомендуется)

1. При первом деплое Railway уже мог подключить репозиторий.
2. Убедитесь, что в настройках сервиса включено: **Settings** → **Source** → **Deploy on push** (или аналог для автодеплоя при пуше в выбранную ветку).
3. Дальше для обновления бота:
   ```bash
   git add .
   git commit -m "Описание изменений"
   git push origin main
   ```
4. Railway сам соберёт новый образ и перезапустит сервис. Статус смотрите в **Deployments** и **Logs**.

### Вариант B: Ручной деплой через CLI

1. Установите [Railway CLI](https://docs.railway.com/guides/cli).
2. В папке проекта:
   ```bash
   railway login
   railway link   # привязать к нужному проекту/сервису
   railway up
   ```
   Обновление уйдёт в тот сервис, к которому привязан проект.

### Что не теряется при обновлении

- **Variables** (в т.ч. `BOT_TOKEN`, `DB_PATH`) хранятся в Railway и не зависят от кода.
- **Volume** с путём `/data` и файлом `quiz_bot.db` сохраняется между деплоями, если задан `DB_PATH=/data/quiz_bot.db`.
- Файл `words.json` подтягивается из репозитория при каждом деплое — меняется при следующем `git push`.

---

## 4. Полезные ссылки и команды

| Действие              | Где в Railway / команда              |
|-----------------------|--------------------------------------|
| Логи                  | Сервис → **Logs**                    |
| Переменные            | Сервис → **Variables**               |
| Рестарт               | **Deployments** → последний деплой → **Redeploy** |
| Ручная команда запуска| **Settings** → **Start Command**     |
| Том для БД            | **Settings** → **Volumes**           |

---

## 5. Локальная разработка

В проекте подключён `python-dotenv`: при запуске `python bot.py` автоматически подгружается файл `.env` из корня (если есть).

1. Создайте в корне проекта файл `.env` (он в `.gitignore`, в репозиторий не попадёт):
   ```
   BOT_TOKEN=ваш_токен_от_BotFather
   DB_PATH=quiz_bot.db
   ```
2. Запуск: `python bot.py`.

После настройки деплоя все дальнейшие обновления сводятся к правкам в коде и `git push` (при включённом автодеплое).
